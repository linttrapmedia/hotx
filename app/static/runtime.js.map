{
  "version": 3,
  "sources": ["../../impl/browser/hotx/runtime/Hotx.ts", "../../impl/browser/hotx/runtime/runtime.ts"],
  "sourcesContent": [
    "/// <reference lib=\"dom\" />\n\nexport type HotxResponse = {\n  state: any;\n  data: FormData;\n  dom: any;\n};\n\nexport class Hotx {\n  _state: string;\n  constructor() {\n    this._state = \"INIT\";\n  }\n  dispatch(method: string, api: string, event: string, data: FormData) {\n    data.append(\"state\", this.state);\n    data.append(\"event\", event);\n\n    const config = (() => {\n      if (method !== \"GET\")\n        return { api, options: { method: method, body: data } };\n      const urlSearchParams = new URLSearchParams();\n      data.forEach((value, key) => urlSearchParams.append(key, value as any));\n      return { api: api + \"?\" + urlSearchParams.toString() };\n    })();\n\n    console.log(config);\n\n    return fetch(config.api, config.options)\n      .then(async (response) => {\n        if (!response.ok) throw new Error(response.statusText);\n        const json = (await response.json()) as HotxResponse;\n        window.hotx.state = json.state;\n        Object.entries(json.dom).forEach(([action, updates]) => {\n          Object.entries(updates as any).forEach(([selector, html]) => {\n            const el: any = document.querySelector(selector);\n            if (el) el[action] = html;\n          });\n        });\n        return json;\n      })\n      .catch((error) => {\n        console.error(\n          \"There has been a problem with your fetch operation:\",\n          error\n        );\n      });\n  }\n  get state() {\n    return this._state;\n  }\n  set state(newState: string) {\n    this._state = newState;\n  }\n}\n",
  "/// <reference lib=\"dom\" />\nimport { Hotx } from \"./Hotx\";\n\nfunction getHotDataAttr(element: Element) {\n  const val = element.getAttribute(\"hot-data\");\n  return val ?? null;\n}\n\nfunction getHotDeleteAttr(element: Element) {\n  const val = element.getAttribute(\"hot-delete\");\n  return val ?? null;\n}\n\nfunction getHotEventAttr(element: Element) {\n  const val = element.getAttribute(\"hot-event\");\n  return val ?? \"\";\n}\n\nfunction getHotFormAttr(element: Element) {\n  const val = element.getAttribute(\"hot-form\");\n  return val ?? null;\n}\n\nfunction getHotPatchAttr(element: Element) {\n  const val = element.getAttribute(\"hot-patch\");\n  return val ?? null;\n}\n\nfunction getHotPostAttr(element: Element) {\n  const val = element.getAttribute(\"hot-post\");\n  return val ?? null;\n}\n\nfunction getHotPutAttr(element: Element) {\n  const val = element.getAttribute(\"hot-put\");\n  return val ?? null;\n}\n\nfunction getHotGetAttr(element: Element) {\n  const val = element.getAttribute(\"hot-get\");\n  return val ?? null;\n}\n\nfunction getHotTriggerAttr(element: Element) {\n  const val = element.getAttribute(\"hot-trigger\");\n  const defaultVal =\n    element.tagName === \"INPUT\"\n      ? \"change\"\n      : element.tagName === \"SELECT\"\n      ? \"change\"\n      : element.tagName === \"TEXTAREA\"\n      ? \"change\"\n      : element.tagName === \"FORM\"\n      ? \"submit\"\n      : \"click\";\n  return val ?? defaultVal;\n}\n\nfunction handleData(\n  element: Element,\n  hotData: string,\n  method: \"GET\" | \"POST\" | \"PUT\" | \"PATCH\" | \"DELETE\",\n  endpoint: string,\n  hotEvent: string\n) {\n  const data =\n    hotData === \"this\"\n      ? (element as any)\n      : (document.querySelector(hotData) as HTMLFormElement);\n  const formData = new FormData();\n  Object.entries(data.dataset).forEach(([key, value]) =>\n    formData.append(key, value as any)\n  );\n  window.hotx.dispatch(method, endpoint, hotEvent, formData);\n}\n\nfunction handleForm(\n  element: Element,\n  hotForm: string,\n  method: \"GET\" | \"POST\" | \"PUT\" | \"PATCH\" | \"DELETE\",\n  endpoint: string,\n  hotEvent: string\n) {\n  const formElement =\n    hotForm === \"this\"\n      ? (element as any)\n      : (document.querySelector(hotForm) as HTMLFormElement);\n  const formData = new FormData(formElement);\n  window.hotx\n    .dispatch(method, endpoint, hotEvent, formData)\n    .then(() => formElement.reset());\n}\n\nfunction registerHotxElements(scope: Document | Element) {\n  const elements = Array.from(\n    scope.querySelectorAll(\n      \"[hot-post],[hot-get],[hot-patch],[hot-delete],[hot-put],[hot-form],[hot-data],[hot-trigger]\"\n    )\n  );\n  for (const el of elements.values()) {\n    if (el.getAttribute(\"hot-ready\") === \"true\") continue;\n    const hotData = getHotDataAttr(el);\n    const hotDelete = getHotDeleteAttr(el);\n    const hotEvent = getHotEventAttr(el);\n    const hotForm = getHotFormAttr(el);\n    const hotGet = getHotGetAttr(el);\n    const hotPatch = getHotPatchAttr(el);\n    const hotPost = getHotPostAttr(el);\n    const hotPut = getHotPutAttr(el);\n    const hotTrigger = getHotTriggerAttr(el);\n    el.setAttribute(\"hot-ready\", \"true\");\n    el.addEventListener(hotTrigger, function (e) {\n      e.preventDefault();\n\n      // handle \"form\" submission\n      if (hotForm) {\n        if (hotPost) handleForm(el, hotForm, \"POST\", hotPost, hotEvent);\n        if (hotGet) handleForm(el, hotForm, \"GET\", hotGet, hotEvent);\n        if (hotPatch) handleForm(el, hotForm, \"PATCH\", hotPatch, hotEvent);\n        if (hotDelete) handleForm(el, hotForm, \"DELETE\", hotDelete, hotEvent);\n        if (hotPut) handleForm(el, hotForm, \"PUT\", hotPut, hotEvent);\n      }\n\n      // handle \"data\" submission\n      if (hotData) {\n        if (hotPost) handleData(el, hotData, \"POST\", hotPost, hotEvent);\n        if (hotGet) handleData(el, hotData, \"GET\", hotGet, hotEvent);\n        if (hotPatch) handleData(el, hotData, \"PATCH\", hotPatch, hotEvent);\n        if (hotDelete) handleData(el, hotData, \"DELETE\", hotDelete, hotEvent);\n        if (hotPut) handleData(el, hotData, \"PUT\", hotPut, hotEvent);\n      }\n    });\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  (<any>window).hotx = new Hotx();\n\n  // register hotx elements on page load\n  registerHotxElements(document);\n\n  // register hotx elements on page mutation\n  new MutationObserver(function (records) {\n    for (const r of records) registerHotxElements(r.target as Element);\n  }).observe(document, {\n    childList: true,\n    subtree: true,\n  });\n});\n"
  ],
  "mappings": "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",
  "debugId": "325C081B145B794A64756e2164756e21",
  "names": []
}