{
  "version": 3,
  "sources": ["../../impl/browser/hotx/runtime/Hotx.ts", "../../impl/browser/hotx/runtime/runtime.ts"],
  "sourcesContent": [
    "/// <reference lib=\"dom\" />\n\nexport type HotxResponse = {\n  state: any;\n  data: FormData;\n  dom: any;\n};\n\nexport class Hotx {\n  _state: string;\n  constructor() {\n    this._state = \"INIT\";\n  }\n  dispatch(method: string, api: string, event: string, data: FormData) {\n    data.append(\"state\", this.state);\n    data.append(\"event\", event);\n\n    const config = (() => {\n      if (method !== \"GET\")\n        return { api, options: { method: method, body: data } };\n      const urlSearchParams = new URLSearchParams();\n      data.forEach((value, key) => urlSearchParams.append(key, value as any));\n      return { api: api + \"?\" + urlSearchParams.toString() };\n    })();\n\n    console.log(config);\n\n    return fetch(config.api, config.options)\n      .then(async (response) => {\n        if (!response.ok) throw new Error(response.statusText);\n        const json = (await response.json()) as HotxResponse;\n        window.hotx.state = json.state;\n        Object.entries(json.dom).forEach(([action, updates]) => {\n          Object.entries(updates as any).forEach(([selector, html]) => {\n            const el: any = document.querySelector(selector);\n            if (el) el[action] = html;\n          });\n        });\n        return json;\n      })\n      .catch((error) => {\n        console.error(\n          \"There has been a problem with your fetch operation:\",\n          error\n        );\n      });\n  }\n  get state() {\n    return this._state;\n  }\n  set state(newState: string) {\n    this._state = newState;\n  }\n}\n",
  "/// <reference lib=\"dom\" />\nimport { Hotx } from \"./Hotx\";\n\nfunction getHotDataAttr(element: Element) {\n  const val = element.getAttribute(\"hot-data\");\n  return val ?? null;\n}\n\nfunction getHotDeleteAttr(element: Element) {\n  const val = element.getAttribute(\"hot-delete\");\n  return val ?? null;\n}\n\nfunction getHotEventAttr(element: Element) {\n  const val = element.getAttribute(\"hot-event\");\n  return val ?? \"\";\n}\n\nfunction getHotFormAttr(element: Element) {\n  const val = element.getAttribute(\"hot-form\");\n  return val ?? null;\n}\n\nfunction getHotPatchAttr(element: Element) {\n  const val = element.getAttribute(\"hot-patch\");\n  return val ?? null;\n}\n\nfunction getHotPostAttr(element: Element) {\n  const val = element.getAttribute(\"hot-post\");\n  return val ?? null;\n}\n\nfunction getHotPutAttr(element: Element) {\n  const val = element.getAttribute(\"hot-put\");\n  return val ?? null;\n}\n\nfunction getHotGetAttr(element: Element) {\n  const val = element.getAttribute(\"hot-get\");\n  return val ?? null;\n}\n\nfunction getHotTriggerAttr(element: Element) {\n  const val = element.getAttribute(\"hot-trigger\");\n  const defaultVal =\n    element.tagName === \"INPUT\"\n      ? \"change\"\n      : element.tagName === \"SELECT\"\n      ? \"change\"\n      : element.tagName === \"TEXTAREA\"\n      ? \"change\"\n      : element.tagName === \"FORM\"\n      ? \"submit\"\n      : \"click\";\n  return val ?? defaultVal;\n}\n\nfunction getHotWebComponent(element: Element) {\n  const val = element.getAttribute(\"hot-web-component\");\n  return val ?? null;\n}\n\nfunction handleData(\n  element: Element,\n  hotData: string,\n  method: \"GET\" | \"POST\" | \"PUT\" | \"PATCH\" | \"DELETE\",\n  endpoint: string,\n  hotEvent: string\n) {\n  const data =\n    hotData === \"this\"\n      ? (element as any)\n      : (document.querySelector(hotData) as HTMLFormElement);\n  const formData = new FormData();\n  Object.entries(data.dataset).forEach(([key, value]) =>\n    formData.append(key, value as any)\n  );\n  window.hotx.dispatch(method, endpoint, hotEvent, formData);\n}\n\nfunction handleForm(\n  element: Element,\n  hotForm: string,\n  method: \"GET\" | \"POST\" | \"PUT\" | \"PATCH\" | \"DELETE\",\n  endpoint: string,\n  hotEvent: string\n) {\n  const formElement =\n    hotForm === \"this\"\n      ? (element as any)\n      : (document.querySelector(hotForm) as HTMLFormElement);\n  const formData = new FormData(formElement);\n  window.hotx\n    .dispatch(method, endpoint, hotEvent, formData)\n    .then(() => formElement.reset());\n}\n\nfunction handleWebComponent(hotWebComponent: string) {\n  const webElements = hotWebComponent.split(\";\");\n  for (const element of webElements) {\n    const [selector, ...config] = element.split(\":\");\n    const webElement = document.querySelector(selector);\n    console.log(webElement);\n    if (!webElement) continue;\n    for (const entry of config) {\n      for (const keyVal of entry.split(\",\")) {\n        const [key, val] = keyVal.split(\"=\");\n        webElement.setAttribute(key, val);\n      }\n    }\n  }\n}\n\nfunction registerHotxElements(scope: Document | Element) {\n  const elements = Array.from(\n    scope.querySelectorAll(\n      \"[hot-post],[hot-get],[hot-patch],[hot-delete],[hot-put],[hot-form],[hot-data],[hot-trigger],[hot-web-component]\"\n    )\n  );\n  for (const el of elements.values()) {\n    if (el.getAttribute(\"hot-ready\") === \"true\") continue;\n    const hotData = getHotDataAttr(el);\n    const hotDelete = getHotDeleteAttr(el);\n    const hotEvent = getHotEventAttr(el);\n    const hotForm = getHotFormAttr(el);\n    const hotGet = getHotGetAttr(el);\n    const hotPatch = getHotPatchAttr(el);\n    const hotPost = getHotPostAttr(el);\n    const hotPut = getHotPutAttr(el);\n    const hotTrigger = getHotTriggerAttr(el);\n    const hotWebComponent = getHotWebComponent(el);\n    el.setAttribute(\"hot-ready\", \"true\");\n    el.addEventListener(hotTrigger, function (e) {\n      e.preventDefault();\n\n      // handle \"form\" submission\n      if (hotForm) {\n        if (hotPost) handleForm(el, hotForm, \"POST\", hotPost, hotEvent);\n        if (hotGet) handleForm(el, hotForm, \"GET\", hotGet, hotEvent);\n        if (hotPatch) handleForm(el, hotForm, \"PATCH\", hotPatch, hotEvent);\n        if (hotDelete) handleForm(el, hotForm, \"DELETE\", hotDelete, hotEvent);\n        if (hotPut) handleForm(el, hotForm, \"PUT\", hotPut, hotEvent);\n      }\n\n      // handle \"data\" submission\n      if (hotData) {\n        if (hotPost) handleData(el, hotData, \"POST\", hotPost, hotEvent);\n        if (hotGet) handleData(el, hotData, \"GET\", hotGet, hotEvent);\n        if (hotPatch) handleData(el, hotData, \"PATCH\", hotPatch, hotEvent);\n        if (hotDelete) handleData(el, hotData, \"DELETE\", hotDelete, hotEvent);\n        if (hotPut) handleData(el, hotData, \"PUT\", hotPut, hotEvent);\n      }\n\n      // handle \"web-el\" submission\n      if (hotWebComponent) handleWebComponent(hotWebComponent);\n    });\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  (<any>window).hotx = new Hotx();\n\n  // register hotx elements on page load\n  registerHotxElements(document);\n\n  // register hotx elements on page mutation\n  new MutationObserver(function (records) {\n    for (const r of records) registerHotxElements(r.target as Element);\n  }).observe(document, {\n    childList: true,\n    subtree: true,\n  });\n});\n"
  ],
  "mappings": "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",
  "debugId": "3DE0C252B94E4A4164756e2164756e21",
  "names": []
}