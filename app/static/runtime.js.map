{
  "version": 3,
  "sources": ["../../impl/browser/hotx/runtime/Hotx.ts", "../../impl/browser/hotx/runtime/runtime.ts"],
  "sourcesContent": [
    "/// <reference lib=\"dom\" />\n\nexport type HotxResponse = {\n  state: any;\n  data: FormData;\n  dom: any;\n};\n\nexport class Hotx {\n  _state: string;\n  _elements: Record<string, Element>;\n  constructor() {\n    this._state = \"INIT\";\n    this._elements = {};\n  }\n  addElement(id: string, element: Element) {\n    this._elements[id] = element;\n  }\n  dispatch(method: string, api: string, event: string, data: FormData) {\n    data.append(\"state\", this.state);\n    data.append(\"event\", event);\n\n    const config = (() => {\n      if (method !== \"GET\")\n        return { api, options: { method: method, body: data } };\n      const urlSearchParams = new URLSearchParams();\n      data.forEach((value, key) => urlSearchParams.append(key, value as any));\n      return { api: api + \"?\" + urlSearchParams.toString() };\n    })();\n\n    return fetch(config.api, config.options)\n      .then(async (response) => {\n        if (!response.ok) throw new Error(response.statusText);\n        const json = (await response.json()) as HotxResponse;\n        window.hotx.state = json.state;\n        json.dom.forEach(\n          ([selector, action, ...args]: [string, string, ...any]) => {\n            const el: any = document.querySelector(selector);\n            if (!el) return;\n            if (action === \"outerHTML\") el.outerHTML = args[0];\n            if (action === \"innerHTML\") el.innerHTML = args[0];\n            if (action === \"setAttribute\")\n              args[1] === null\n                ? el.removeAttribute(args[0])\n                : el.setAttribute(args[0], args[1]);\n          }\n        );\n        return json;\n      })\n      .catch((error) => {\n        console.error(\n          \"There has been a problem with your fetch operation:\",\n          error\n        );\n      });\n  }\n  get elements() {\n    return this._elements;\n  }\n  get state() {\n    return this._state;\n  }\n  set state(newState: string) {\n    this._state = newState;\n  }\n}\n",
  "/// <reference lib=\"dom\" />\nimport { Hotx } from \"./Hotx\";\n\nconst ATTRS = [\n  \"hot-data\",\n  \"hot-delete\",\n  \"hot-form\",\n  \"hot-get\",\n  \"hot-id\",\n  \"hot-patch\",\n  \"hot-post\",\n  \"hot-put\",\n  \"hot-trigger\",\n  \"hot\\\\:click\",\n  \"hot\\\\:submit\",\n];\n\nfunction getAttr(element: Element, attr: string, nullVal: any = null) {\n  const val = element.getAttribute(attr);\n  return val ?? nullVal;\n}\n\nfunction handleClick(el: Element) {\n  el.addEventListener(\"click\", function (e: any) {\n    const input = el.getAttribute(\"hot:click\") ?? \"\";\n    const mutations = input\n      .split(\";\")\n      .map((s) => s.trim())\n      .filter(Boolean);\n    mutations.forEach((mutation) => {\n      const regex = /^([^\\[]+)\\[(.+)\\]$/;\n      const matches = mutation.match(regex);\n      if (!matches) return;\n      const selector = matches[1];\n      const attributes = matches[2];\n      if (selector && attributes) {\n        attributes\n          .slice(0, -1)\n          .split(\",\")\n          .map((a) => a.trim())\n          .forEach((attr) => {\n            const [key, value] = attr.split(\"=\");\n            if (selector === \"this\") return el.setAttribute(key, value);\n            document.querySelector(selector)?.setAttribute(key, value);\n          });\n      }\n    });\n  });\n}\n\nfunction handleData(\n  element: Element,\n  hotData: string,\n  method: \"GET\" | \"POST\" | \"PUT\" | \"PATCH\" | \"DELETE\",\n  endpoint: string,\n  hotEvent: string\n) {\n  const data =\n    hotData === \"this\"\n      ? (element as any)\n      : (document.querySelector(hotData) as HTMLFormElement);\n  const formData = new FormData();\n  Object.entries(data.dataset).forEach(([key, value]) =>\n    formData.append(key, value as any)\n  );\n  window.hotx.dispatch(method, endpoint, hotEvent, formData);\n}\n\nfunction handleId(id: string, el: Element) {\n  window.hotx.addElement(id, el);\n}\n\nfunction handleForm(\n  element: Element,\n  hotForm: string,\n  method: \"GET\" | \"POST\" | \"PUT\" | \"PATCH\" | \"DELETE\",\n  endpoint: string,\n  hotEvent: string\n) {\n  const formElement =\n    hotForm === \"this\"\n      ? (element as any)\n      : (document.querySelector(hotForm) as HTMLFormElement);\n  const formData = new FormData(formElement);\n  window.hotx\n    .dispatch(method, endpoint, hotEvent, formData)\n    .then(() => formElement.reset());\n}\n\nfunction handleSubmit(el: Element) {\n  el.addEventListener(\"submit\", function (e: any) {\n    e.preventDefault();\n    const input = el.getAttribute(\"hot:submit\") ?? \"\";\n    const mutations = input\n      .split(\";\")\n      .map((s) => s.trim())\n      .filter(Boolean);\n    mutations.forEach((mutation) => {\n      const regex = /^([^\\[]+)\\[(.+)\\]$/;\n      const matches = mutation.match(regex);\n      if (!matches) return;\n      const selector = matches[1];\n      const attributes = matches[2];\n      if (selector && attributes) {\n        attributes\n          .slice(0, -1)\n          .split(\",\")\n          .map((a) => a.trim())\n          .forEach((attr) => {\n            const [key, value] = attr.split(\"=\");\n            if (selector === \"this\") return el.setAttribute(key, value);\n            document.querySelector(selector)?.setAttribute(key, value);\n          });\n      }\n    });\n  });\n}\n\nfunction handleTrigger(o: {\n  el: Element;\n  data: string;\n  delete: string;\n  event: string;\n  form: string;\n  get: string;\n  id: string;\n  patch: string;\n  post: string;\n  put: string;\n  trigger: string;\n}) {\n  o.el.addEventListener(o.trigger, function (e: any) {\n    // handle \"form\" submission\n    if (o.form) {\n      if (o.post) handleForm(o.el, o.form, \"POST\", o.post, o.event);\n      if (o.get) handleForm(o.el, o.form, \"GET\", o.get, o.event);\n      if (o.patch) handleForm(o.el, o.form, \"PATCH\", o.patch, o.event);\n      if (o.delete) handleForm(o.el, o.form, \"DELETE\", o.delete, o.event);\n      if (o.put) handleForm(o.el, o.form, \"PUT\", o.put, o.event);\n    }\n\n    // handle \"data\" submission\n    if (o.data) {\n      if (o.post) handleData(o.el, o.data, \"POST\", o.post, o.event);\n      if (o.get) handleData(o.el, o.data, \"GET\", o.get, o.event);\n      if (o.patch) handleData(o.el, o.data, \"PATCH\", o.patch, o.event);\n      if (o.delete) handleData(o.el, o.data, \"DELETE\", o.delete, o.event);\n      if (o.put) handleData(o.el, o.data, \"PUT\", o.put, o.event);\n    }\n  });\n}\n\nfunction registerElements(scope: Document | Element) {\n  const attrs = ATTRS.map((attr) => `*[${attr}]:not([hot-ready])`);\n  const elements = Array.from(scope.querySelectorAll(`${attrs.join(\", \")}`));\n  for (const el of elements.values()) {\n    const attrs = {\n      el,\n      data: getAttr(el, \"hot-data\", null),\n      delete: getAttr(el, \"hot-delete\", null),\n      event: getAttr(el, \"hot-event\", null),\n      form: getAttr(el, \"hot-form\", null),\n      get: getAttr(el, \"hot-get\", null),\n      id: getAttr(el, \"hot-id\", null),\n      click: getAttr(el, \"hot:click\", null),\n      patch: getAttr(el, \"hot-patch\", null),\n      post: getAttr(el, \"hot-post\", null),\n      put: getAttr(el, \"hot-put\", null),\n      submit: getAttr(el, \"hot:submit\", null),\n      trigger: getAttr(el, \"hot-trigger\", null),\n    };\n    if (attrs.id) handleId(attrs.id, el);\n    if (attrs.trigger) handleTrigger(attrs);\n    if (attrs.click) handleClick(el);\n    if (attrs.submit) handleSubmit(el);\n    el.setAttribute(\"hot-ready\", \"true\");\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  (<any>window).hotx = new Hotx();\n\n  // register hotx elements on page load\n  registerElements(document);\n\n  // register hotx elements on page mutation\n  new MutationObserver(function (records) {\n    for (const r of records) registerElements(r.target as Element);\n  }).observe(document, {\n    childList: true,\n    subtree: true,\n  });\n});\n"
  ],
  "mappings": ";AAQO,MAAM,KAAK;AAAA,EAChB;AAAA,EACA;AAAA,EACA,WAAW,GAAG;AACZ,SAAK,SAAS;AACd,SAAK,YAAY,CAAC;AAAA;AAAA,EAEpB,UAAU,CAAC,IAAY,SAAkB;AACvC,SAAK,UAAU,MAAM;AAAA;AAAA,EAEvB,QAAQ,CAAC,QAAgB,KAAa,OAAe,MAAgB;AACnE,SAAK,OAAO,SAAS,KAAK,KAAK;AAC/B,SAAK,OAAO,SAAS,KAAK;AAE1B,UAAM,UAAU,MAAM;AACpB,UAAI,WAAW;AACb,eAAO,EAAE,KAAK,SAAS,EAAE,QAAgB,MAAM,KAAK,EAAE;AACxD,YAAM,kBAAkB,IAAI;AAC5B,WAAK,QAAQ,CAAC,OAAO,QAAQ,gBAAgB,OAAO,KAAK,KAAY,CAAC;AACtE,aAAO,EAAE,KAAK,MAAM,MAAM,gBAAgB,SAAS,EAAE;AAAA,OACpD;AAEH,WAAO,MAAM,OAAO,KAAK,OAAO,OAAO,EACpC,KAAK,OAAO,aAAa;AACxB,WAAK,SAAS;AAAI,cAAM,IAAI,MAAM,SAAS,UAAU;AACrD,YAAM,OAAQ,MAAM,SAAS,KAAK;AAClC,aAAO,KAAK,QAAQ,KAAK;AACzB,WAAK,IAAI,QACP,EAAE,UAAU,WAAW,UAAoC;AACzD,cAAM,KAAU,SAAS,cAAc,QAAQ;AAC/C,aAAK;AAAI;AACT,YAAI,WAAW;AAAa,aAAG,YAAY,KAAK;AAChD,YAAI,WAAW;AAAa,aAAG,YAAY,KAAK;AAChD,YAAI,WAAW;AACb,eAAK,OAAO,OACR,GAAG,gBAAgB,KAAK,EAAE,IAC1B,GAAG,aAAa,KAAK,IAAI,KAAK,EAAE;AAAA,OAE1C;AACA,aAAO;AAAA,KACR,EACA,MAAM,CAAC,UAAU;AAChB,cAAQ,MACN,uDACA,KACF;AAAA,KACD;AAAA;AAAA,MAED,QAAQ,GAAG;AACb,WAAO,KAAK;AAAA;AAAA,MAEV,KAAK,GAAG;AACV,WAAO,KAAK;AAAA;AAAA,MAEV,KAAK,CAAC,UAAkB;AAC1B,SAAK,SAAS;AAAA;AAElB;;;AChDA,IAAS,kBAAO,CAAC,SAAkB,MAAc,UAAe,MAAM;AACpE,QAAM,MAAM,QAAQ,aAAa,IAAI;AACrC,SAAO,OAAO;AAAA;AAGhB,IAAS,sBAAW,CAAC,IAAa;AAChC,KAAG,iBAAiB,iBAAkB,CAAC,GAAQ;AAC7C,UAAM,QAAQ,GAAG,aAAa,WAAW,KAAK;AAC9C,UAAM,YAAY,MACf,MAAM,GAAG,EACT,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,EACnB,OAAO,OAAO;AACjB,cAAU,QAAQ,CAAC,aAAa;AAC9B,YAAM,QAAQ;AACd,YAAM,UAAU,SAAS,MAAM,KAAK;AACpC,WAAK;AAAS;AACd,YAAM,WAAW,QAAQ;AACzB,YAAM,aAAa,QAAQ;AAC3B,UAAI,YAAY,YAAY;AAC1B,mBACG,MAAM,IAAG,CAAE,EACX,MAAM,GAAG,EACT,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,EACnB,QAAQ,CAAC,SAAS;AACjB,iBAAO,KAAK,SAAS,KAAK,MAAM,GAAG;AACnC,cAAI,aAAa;AAAQ,mBAAO,GAAG,aAAa,KAAK,KAAK;AAC1D,mBAAS,cAAc,QAAQ,GAAG,aAAa,KAAK,KAAK;AAAA,SAC1D;AAAA,MACL;AAAA,KACD;AAAA,GACF;AAAA;AAGH,IAAS,qBAAU,CACjB,SACA,SACA,QACA,UACA,UACA;AACA,QAAM,OACJ,YAAY,SACP,UACA,SAAS,cAAc,OAAO;AACrC,QAAM,WAAW,IAAI;AACrB,SAAO,QAAQ,KAAK,OAAO,EAAE,QAAQ,EAAE,KAAK,WAC1C,SAAS,OAAO,KAAK,KAAY,CACnC;AACA,SAAO,KAAK,SAAS,QAAQ,UAAU,UAAU,QAAQ;AAAA;AAG3D,IAAS,mBAAQ,CAAC,IAAY,IAAa;AACzC,SAAO,KAAK,WAAW,IAAI,EAAE;AAAA;AAG/B,IAAS,qBAAU,CACjB,SACA,SACA,QACA,UACA,UACA;AACA,QAAM,cACJ,YAAY,SACP,UACA,SAAS,cAAc,OAAO;AACrC,QAAM,WAAW,IAAI,SAAS,WAAW;AACzC,SAAO,KACJ,SAAS,QAAQ,UAAU,UAAU,QAAQ,EAC7C,KAAK,MAAM,YAAY,MAAM,CAAC;AAAA;AAGnC,IAAS,uBAAY,CAAC,IAAa;AACjC,KAAG,iBAAiB,kBAAmB,CAAC,GAAQ;AAC9C,MAAE,eAAe;AACjB,UAAM,QAAQ,GAAG,aAAa,YAAY,KAAK;AAC/C,UAAM,YAAY,MACf,MAAM,GAAG,EACT,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,EACnB,OAAO,OAAO;AACjB,cAAU,QAAQ,CAAC,aAAa;AAC9B,YAAM,QAAQ;AACd,YAAM,UAAU,SAAS,MAAM,KAAK;AACpC,WAAK;AAAS;AACd,YAAM,WAAW,QAAQ;AACzB,YAAM,aAAa,QAAQ;AAC3B,UAAI,YAAY,YAAY;AAC1B,mBACG,MAAM,IAAG,CAAE,EACX,MAAM,GAAG,EACT,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,EACnB,QAAQ,CAAC,SAAS;AACjB,iBAAO,KAAK,SAAS,KAAK,MAAM,GAAG;AACnC,cAAI,aAAa;AAAQ,mBAAO,GAAG,aAAa,KAAK,KAAK;AAC1D,mBAAS,cAAc,QAAQ,GAAG,aAAa,KAAK,KAAK;AAAA,SAC1D;AAAA,MACL;AAAA,KACD;AAAA,GACF;AAAA;AAGH,IAAS,wBAAa,CAAC,GAYpB;AACD,IAAE,GAAG,iBAAiB,EAAE,iBAAkB,CAAC,GAAQ;AAEjD,QAAI,EAAE,MAAM;AACV,UAAI,EAAE;AAAM,mBAAW,EAAE,IAAI,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,KAAK;AAC5D,UAAI,EAAE;AAAK,mBAAW,EAAE,IAAI,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,KAAK;AACzD,UAAI,EAAE;AAAO,mBAAW,EAAE,IAAI,EAAE,MAAM,SAAS,EAAE,OAAO,EAAE,KAAK;AAC/D,UAAI,EAAE;AAAQ,mBAAW,EAAE,IAAI,EAAE,MAAM,UAAU,EAAE,QAAQ,EAAE,KAAK;AAClE,UAAI,EAAE;AAAK,mBAAW,EAAE,IAAI,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,KAAK;AAAA,IAC3D;AAGA,QAAI,EAAE,MAAM;AACV,UAAI,EAAE;AAAM,mBAAW,EAAE,IAAI,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,KAAK;AAC5D,UAAI,EAAE;AAAK,mBAAW,EAAE,IAAI,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,KAAK;AACzD,UAAI,EAAE;AAAO,mBAAW,EAAE,IAAI,EAAE,MAAM,SAAS,EAAE,OAAO,EAAE,KAAK;AAC/D,UAAI,EAAE;AAAQ,mBAAW,EAAE,IAAI,EAAE,MAAM,UAAU,EAAE,QAAQ,EAAE,KAAK;AAClE,UAAI,EAAE;AAAK,mBAAW,EAAE,IAAI,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,KAAK;AAAA,IAC3D;AAAA,GACD;AAAA;AAGH,IAAS,2BAAgB,CAAC,OAA2B;AACnD,QAAM,QAAQ,MAAM,IAAI,CAAC,SAAS,KAAK,wBAAwB;AAC/D,QAAM,WAAW,MAAM,KAAK,MAAM,iBAAiB,GAAG,MAAM,KAAK,IAAI,GAAG,CAAC;AACzE,aAAW,MAAM,SAAS,OAAO,GAAG;AAClC,UAAM,SAAQ;AAAA,MACZ;AAAA,MACA,MAAM,QAAQ,IAAI,YAAY,IAAI;AAAA,MAClC,QAAQ,QAAQ,IAAI,cAAc,IAAI;AAAA,MACtC,OAAO,QAAQ,IAAI,aAAa,IAAI;AAAA,MACpC,MAAM,QAAQ,IAAI,YAAY,IAAI;AAAA,MAClC,KAAK,QAAQ,IAAI,WAAW,IAAI;AAAA,MAChC,IAAI,QAAQ,IAAI,UAAU,IAAI;AAAA,MAC9B,OAAO,QAAQ,IAAI,aAAa,IAAI;AAAA,MACpC,OAAO,QAAQ,IAAI,aAAa,IAAI;AAAA,MACpC,MAAM,QAAQ,IAAI,YAAY,IAAI;AAAA,MAClC,KAAK,QAAQ,IAAI,WAAW,IAAI;AAAA,MAChC,QAAQ,QAAQ,IAAI,cAAc,IAAI;AAAA,MACtC,SAAS,QAAQ,IAAI,eAAe,IAAI;AAAA,IAC1C;AACA,QAAI,OAAM;AAAI,eAAS,OAAM,IAAI,EAAE;AACnC,QAAI,OAAM;AAAS,oBAAc,MAAK;AACtC,QAAI,OAAM;AAAO,kBAAY,EAAE;AAC/B,QAAI,OAAM;AAAQ,mBAAa,EAAE;AACjC,OAAG,aAAa,aAAa,MAAM;AAAA,EACrC;AAAA;AA7KF,IAAM,QAAQ;AAAA,EACZ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAoKA,SAAS,iBAAiB,4BAA6B,GAAG;AACxD,EAAM,OAAQ,OAAO,IAAI;AAGzB,mBAAiB,QAAQ;AAGzB,MAAI,yBAA0B,CAAC,SAAS;AACtC,eAAW,KAAK;AAAS,uBAAiB,EAAE,MAAiB;AAAA,GAC9D,EAAE,QAAQ,UAAU;AAAA,IACnB,WAAW;AAAA,IACX,SAAS;AAAA,EACX,CAAC;AAAA,CACF;",
  "debugId": "79C314CAA78D5FBD64756e2164756e21",
  "names": []
}