{
  "version": 3,
  "sources": ["../../impl/browser/hotx/runtime/Hotx.ts", "../../impl/browser/hotx/runtime/runtime.ts"],
  "sourcesContent": [
    "/// <reference lib=\"dom\" />\n\nexport type HotxResponse = {\n  state: any;\n  data: FormData;\n  dom: any;\n};\n\nexport class Hotx {\n  _state: string;\n  constructor() {\n    this._state = \"INIT\";\n  }\n  dispatch(machine: string, event: string, data: FormData) {\n    data.append(\"state\", this.state);\n    data.append(\"event\", event);\n    return fetch(machine ?? \"/api\", {\n      method: \"POST\",\n      body: data,\n    })\n      .then(async (response) => {\n        if (!response.ok) throw new Error(response.statusText);\n        const json = (await response.json()) as HotxResponse;\n        window.hotx.state = json.state;\n        Object.entries(json.dom).forEach(([action, updates]) => {\n          Object.entries(updates as any).forEach(([selector, html]) => {\n            const el: any = document.querySelector(selector);\n            if (el) el[action] = html;\n          });\n        });\n        return json;\n      })\n      .catch((error) => {\n        console.error(\n          \"There has been a problem with your fetch operation:\",\n          error\n        );\n      });\n  }\n  get state() {\n    return this._state;\n  }\n  set state(newState: string) {\n    this._state = newState;\n  }\n}\n",
  "/// <reference lib=\"dom\" />\nimport { Hotx } from \"./Hotx\";\n\nfunction getHotDataAttr(element: Element) {\n  const val = element.getAttribute(\"hot-data\");\n  return val ?? null;\n}\n\nfunction getHotEventAttr(element: Element) {\n  const val = element.getAttribute(\"hot-event\");\n  return val ?? \"\";\n}\n\nfunction getHotFormAttr(element: Element) {\n  const val = element.getAttribute(\"hot-form\");\n  return val ?? null;\n}\n\nfunction getHotMachineAttr(element: Element) {\n  const val = element.getAttribute(\"hot-machine\");\n  return val ?? \"/api\";\n}\n\nfunction getHotTriggerAttr(element: Element) {\n  const val = element.getAttribute(\"hot-trigger\");\n  const defaultVal =\n    element.tagName === \"INPUT\"\n      ? \"change\"\n      : element.tagName === \"SELECT\"\n      ? \"change\"\n      : element.tagName === \"TEXTAREA\"\n      ? \"change\"\n      : element.tagName === \"FORM\"\n      ? \"submit\"\n      : \"click\";\n  return val ?? defaultVal;\n}\n\nfunction getHotWebElementAttr(element: Element) {\n  const val = element.getAttribute(\"hot-web-element\");\n  return val ?? null;\n}\n\nfunction handleDataSubmission(\n  element: Element,\n  hotData: string,\n  hotMachine: string,\n  hotEvent: string\n) {\n  const data =\n    hotData === \"this\"\n      ? (element as any)\n      : (document.querySelector(hotData) as HTMLFormElement);\n  const formData = new FormData();\n  Object.entries(data.dataset).forEach(([key, value]) =>\n    formData.append(key, value as any)\n  );\n  window.hotx.dispatch(hotMachine, hotEvent, formData);\n}\n\nfunction handleFormSubmission(\n  element: Element,\n  hotForm: string,\n  hotMachine: string,\n  hotEvent: string\n) {\n  const formElement =\n    hotForm === \"this\"\n      ? (element as any)\n      : (document.querySelector(hotForm) as HTMLFormElement);\n  const formData = new FormData(formElement);\n  window.hotx\n    .dispatch(hotMachine, hotEvent, formData)\n    .then(() => formElement.reset());\n}\n\nfunction handleWebElementSubmission(element: Element, hotWebElement: string) {\n  const webElements = hotWebElement.split(\";\");\n  for (const element of webElements) {\n    const [selector, ...config] = element.split(\":\");\n    const webElement = document.querySelector(selector);\n    console.log(webElement);\n    if (!webElement) continue;\n    for (const entry of config) {\n      for (const keyVal of entry.split(\",\")) {\n        const [key, val] = keyVal.split(\"=\");\n        webElement.setAttribute(key, val);\n      }\n    }\n  }\n}\n\nfunction registerHotxElements(scope: Document | Element) {\n  const elements = Array.from(scope.querySelectorAll(\"[hot-event]\"));\n  for (const element of elements.values()) {\n    if (element.getAttribute(\"hot-ready\") === \"true\") continue;\n    const hotMachine = getHotMachineAttr(element);\n    const hotEvent = getHotEventAttr(element);\n    const hotForm = getHotFormAttr(element);\n    const hotData = getHotDataAttr(element);\n    const hotTrigger = getHotTriggerAttr(element);\n    const hotWebElement = getHotWebElementAttr(element);\n    element.setAttribute(\"hot-ready\", \"true\");\n    element.addEventListener(hotTrigger, function (e) {\n      e.preventDefault();\n\n      // handle \"form\" submission\n      if (hotForm) handleFormSubmission(element, hotForm, hotMachine, hotEvent);\n\n      // handle \"data\" submission\n      if (hotData) handleDataSubmission(element, hotData, hotMachine, hotEvent);\n\n      // handle \"web-element\" submission\n      if (hotWebElement) handleWebElementSubmission(element, hotWebElement);\n    });\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  (<any>window).hotx = new Hotx();\n\n  // register hotx elements on page load\n  registerHotxElements(document);\n\n  // register hotx elements on page mutation\n  new MutationObserver(function (records) {\n    for (const r of records) registerHotxElements(r.target as Element);\n  }).observe(document, {\n    childList: true,\n    subtree: true,\n  });\n});\n"
  ],
  "mappings": "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",
  "debugId": "5FD82CEDE49EEC6064756e2164756e21",
  "names": []
}